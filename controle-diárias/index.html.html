<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Controle Diarista</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Ajustes para iPhone e Mobile */
        body {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
        }
        
        /* √Årea segura para iPhones com notch/barra inferior */
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Anima√ß√£o suave no toque */
        .tap-effect:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // √çcones SVG Otimizados
        const IconChevronLeft = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"/></svg>;
        const IconChevronRight = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"/></svg>;
        const IconWhatsapp = () => <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>;
        const IconTrash = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>;

        const App = () => {
            const DAILY_RATE = 200;
            
            // Estado e LocalStorage
            const [workedDates, setWorkedDates] = useState(() => {
                try {
                    const saved = localStorage.getItem('diarista_dates_v1');
                    return saved ? JSON.parse(saved) : [
                        "2025-11-11", "2025-11-14", "2025-11-17", "2025-11-19", 
                        "2025-11-21", "2025-11-25", "2025-11-27", "2025-11-28"
                    ];
                } catch (e) { return []; }
            });

            const [currentDate, setCurrentDate] = useState(new Date(2025, 10, 1)); 

            useEffect(() => {
                localStorage.setItem('diarista_dates_v1', JSON.stringify(workedDates));
            }, [workedDates]);

            // Navega√ß√£o e L√≥gica
            const handleMonthChange = (direction) => {
                const newDate = new Date(currentDate);
                newDate.setMonth(currentDate.getMonth() + direction);
                setCurrentDate(newDate);
            };

            const toggleDate = (day) => {
                const year = currentDate.getFullYear();
                const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                const dateKey = `${year}-${month}-${String(day).padStart(2, '0')}`;

                if (workedDates.includes(dateKey)) {
                    setWorkedDates(workedDates.filter(d => d !== dateKey));
                } else {
                    setWorkedDates([...workedDates, dateKey]);
                }
            };

            // C√°lculos
            const currentMonthKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
            const datesInCurrentMonth = workedDates.filter(date => date.startsWith(currentMonthKey));
            const totalDays = datesInCurrentMonth.length;
            const totalValue = totalDays * DAILY_RATE;
            const sortedDates = [...datesInCurrentMonth].sort();

            // Formata√ß√£o
            const formatMoney = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);
            
            const getDayLabel = (dateStr) => {
                const parts = dateStr.split('-');
                const date = new Date(parts[0], parts[1] - 1, parts[2]);
                const dayName = new Intl.DateTimeFormat('pt-BR', { weekday: 'short' }).format(date);
                return dayName.replace('.', '').toUpperCase();
            };

            // Compartilhar WhatsApp
            const shareWhatsApp = () => {
                const monthName = currentDate.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
                let text = `*Resumo Diarista - ${monthName}*\n`;
                text += `üóì Dias trabalhados: ${totalDays}\n`;
                text += `üí∞ Valor Total: ${formatMoney(totalValue)}\n\n`;
                text += `*Dias:* \n`;
                
                sortedDates.forEach(date => {
                    const parts = date.split('-');
                    text += `‚Ä¢ ${parts[2]}/${parts[1]} (${getDayLabel(date)})\n`;
                });

                const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            };

            // Renderiza√ß√£o do Calend√°rio
            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const firstDay = new Date(year, month, 1).getDay();
                const days = [];

                // Cabe√ßalho dos dias da semana
                const weekDays = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
                
                return (
                    <div className="bg-white rounded-3xl shadow-sm p-4 mb-6">
                        <div className="grid grid-cols-7 mb-2 text-center">
                            {weekDays.map((d, i) => (
                                <div key={i} className="text-xs font-bold text-gray-400 py-2">{d}</div>
                            ))}
                        </div>
                        <div className="grid grid-cols-7 gap-y-3 gap-x-1 justify-items-center">
                            {Array.from({ length: firstDay }).map((_, i) => (
                                <div key={`empty-${i}`} className="w-10 h-10"></div>
                            ))}
                            {Array.from({ length: daysInMonth }).map((_, i) => {
                                const day = i + 1;
                                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                const isSelected = workedDates.includes(dateKey);
                                return (
                                    <button
                                        key={day}
                                        onClick={() => toggleDate(day)}
                                        className={`w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center text-lg font-medium tap-effect transition-all duration-200
                                            ${isSelected 
                                                ? 'bg-emerald-500 text-white shadow-md shadow-emerald-200' 
                                                : 'text-gray-700 bg-gray-50'}`}
                                    >
                                        {day}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-100 flex flex-col max-w-md mx-auto shadow-2xl safe-bottom">
                    
                    {/* Header Verde */}
                    <div className="bg-emerald-600 text-white p-6 pt-10 rounded-b-[2.5rem] shadow-lg z-10 relative">
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={() => handleMonthChange(-1)} className="p-2 bg-white/20 rounded-full backdrop-blur-sm tap-effect">
                                <IconChevronLeft />
                            </button>
                            <span className="text-xl font-bold capitalize">
                                {currentDate.toLocaleString('pt-BR', { month: 'long' })}
                            </span>
                            <button onClick={() => handleMonthChange(1)} className="p-2 bg-white/20 rounded-full backdrop-blur-sm tap-effect">
                                <IconChevronRight />
                            </button>
                        </div>
                        
                        <div className="text-center mb-2">
                            <div className="text-emerald-100 text-sm font-medium mb-1">Total a Pagar</div>
                            <div className="text-5xl font-bold tracking-tight">{formatMoney(totalValue)}</div>
                            <div className="mt-2 inline-block bg-emerald-700/50 px-3 py-1 rounded-full text-xs text-emerald-100">
                                {totalDays} di√°rias x R$ {DAILY_RATE}
                            </div>
                        </div>
                    </div>

                    {/* Conte√∫do Principal */}
                    <div className="flex-1 px-4 -mt-8 relative z-20">
                        {renderCalendar()}

                        {/* Bot√£o de A√ß√£o */}
                        <button 
                            onClick={shareWhatsApp}
                            className="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-green-200 flex items-center justify-center gap-2 tap-effect mb-6 transition-colors"
                        >
                            <IconWhatsapp />
                            Enviar Relat√≥rio no WhatsApp
                        </button>

                        {/* Lista de Dias */}
                        <div className="bg-white rounded-3xl p-5 shadow-sm mb-8">
                            <h3 className="font-bold text-gray-800 mb-4 text-sm uppercase tracking-wider text-center">Extrato Detalhado</h3>
                            {sortedDates.length === 0 ? (
                                <p className="text-center text-gray-400 py-4 text-sm">Nenhum dia marcado.</p>
                            ) : (
                                <div className="divide-y divide-gray-100">
                                    {sortedDates.map(date => {
                                        const parts = date.split('-');
                                        return (
                                            <div key={date} className="flex justify-between items-center py-3">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-2 h-2 rounded-full bg-emerald-500"></div>
                                                    <div>
                                                        <span className="font-semibold text-gray-700 text-lg">{parts[2]}/{parts[1]}</span>
                                                        <span className="text-xs text-gray-400 ml-2 font-medium bg-gray-100 px-2 py-0.5 rounded-md">{getDayLabel(date)}</span>
                                                    </div>
                                                </div>
                                                <span className="font-medium text-emerald-600">R$ {DAILY_RATE}</span>
                                            </div>
                                        )
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                    
                    <div className="text-center text-gray-400 text-xs pb-8 safe-bottom">
                        Controle Pessoal ‚Ä¢ 2025/2026
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>